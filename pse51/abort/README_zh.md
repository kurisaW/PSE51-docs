# abort — 生成异常进程中止

## 概要

```c
#include <stdlib.h>

_Noreturn void abort(void);
```

## 描述

`abort()` 函数应当导致异常进程终止发生，除非它生成的 SIGABRT 信号被捕获且信号处理器不返回。

异常终止处理应当包括为 SIGABRT 定义的默认操作，并且可能包括尝试对所有打开的流执行 `fclose()` 的操作。

SIGABRT 信号应当发送到调用线程，就如同通过使用参数 SIGABRT 调用 `raise()` 一样。如果此信号不终止进程（例如，如果信号被捕获且处理器返回），`abort()` 可以将 SIGABRT 的处理方式更改为 SIG_DFL 并再次发送信号（以相同方式）。如果发送了第二个信号且它不终止进程，则行为未指定，但 `abort()` 调用不应返回。

由 `abort()` 提供给 `wait()`、`waitid()` 或 `waitpid()` 的状态应当是进程被 SIGABRT 信号终止的状态。`abort()` 函数应当覆盖阻塞或忽略 SIGABRT 信号。

## 返回值

`abort()` 函数不应返回。

## 错误

未定义错误。

## 示例

无。

## 应用程序用法

捕获信号旨在为应用程序开发人员提供中止处理的可移植方式，不受任何实现提供函数的可能干扰。

## 基本原理

历史上，`abort()` 通过调用其他信号操作函数来实现，如 `raise()`、`sigaction()` 和 `pthread_sigmask()`。这意味着它的操作可能受到其他线程中并发操作的影响。例如，如果 `abort()` 尝试通过调用 `sigaction()` 将 SIGABRT 的处理方式更改为 SIG_DFL 然后调用 `raise()` 来终止进程，另一个线程可能在这两个调用之间更改处理方式，导致进程不被终止。如果发生这种情况，唯一的要求是 `abort()` 不返回。实现可以在循环中调用这些函数（理论上可能无限执行），或者可以通过调用 `_exit()` 来终止进程（这会确保终止但会导致错误的等待状态）。为了避免这些问题，鼓励实现以不受其他线程并发操作影响的方式实现 `abort()`。例如，它可以首先停止所有其他线程的执行，或者可以通过"如同通过信号终止"系统调用来终止进程，而不是通过引发（第二个）SIGABRT。

ISO/IEC 9899:1999 标准要求（当前标准仍然要求）`abort()` 函数是异步信号安全的。由于 POSIX.1-2024 遵循 ISO C 标准，这需要将描述中的"应包括 `fclose()` 的效果"更改为"可能包括尝试执行 `fclose()` 的操作"。

修订后的措辞允许一些向后兼容性，并避免潜在的死锁情况。

应用 Open Group 基础决议 bwg2002-003，从描述中删除以下 XSI 阴影段落：

"在 XSI 兼容系统上，此外异常终止处理应包括对消息目录描述符执行 `fclose()` 的效果。"

删除此段落有几个原因：

* 在异常进程终止之前不需要对打开的消息目录执行特殊处理。
* 特别提及 `abort()` 包括对打开流执行 `fclose()` 效果的主要原因是刷新流上排队的输出。此上下文中的消息目录是只读的，因此不需要刷新。
* 对消息目录描述符执行 `fclose()` 的效果是未指定的。允许但不要求使用文件描述符实现消息目录描述符，但在 POSIX.1-2024 中没有提及消息目录描述符使用标准 I/O 流 FILE 对象，而这正是 `fclose()` 所期望的。

## 未来方向

本标准的未来版本可能要求 `abort()` 以不受其他线程并发操作影响的方式实现。

## 另请参见

`_exit()`、`kill()`、`raise()`、`signal()`、`wait()`、`waitid()`

XBD `<stdlib.h>`

## 变更历史

首次发布于第 1 版。源自 SVID 的第 1 版。

### 第 6 版

标记了超出 ISO C 标准的扩展。

对描述进行了更改以与 ISO/IEC 9899:1999 标准对齐。

应用了 Open Group 基础决议 bwg2002-003。

应用了 IEEE Std 1003.1-2001/Cor 1-2002，项目 XSH/TC1/D6/10，更改了异常终止处理的描述并在基本原理部分添加了内容。

应用了 IEEE Std 1003.1-2001/Cor 2-2004，项目 XSH/TC2/D6/9，在应用程序用法部分将"实现定义的函数"更改为"实现提供的函数"。

### 第 8 版

应用了 Austin Group 缺陷 906，阐明了 `abort()` 的行为如何可能受到其他线程中并发操作的影响。

应用了 Austin Group 缺陷 1302，使此函数与 ISO/IEC 9899:2018 标准对齐。