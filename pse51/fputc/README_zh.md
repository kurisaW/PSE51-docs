# fputc — 向流写入一个字节

## 概要

```c
#include <stdio.h>

int fputc(int c, FILE *stream);
```

## 描述

`fputc()` 函数应将由 `c` 指定的字节（转换为 `unsigned char` 类型）写入到 `stream` 指向的输出流中，写入位置为该流相关文件位置指示器所指示的位置（如果已定义），并应适当地推进指示器。如果文件不支持定位请求，或者流是以追加模式打开的，则字节应被追加到输出流中。

文件的数据最后修改时间戳和文件状态最后更改时间戳应在 `fputc()` 成功执行与下一次对同一流成功完成 `fflush()` 或 `fclose()` 调用，或调用 `exit()` 或 `abort()` 之间被标记为需要更新。

## 返回值

成功完成后，`fputc()` 应返回其写入的值。否则，应返回 EOF，流的错误指示器应被设置，且 `errno` 应被设置为指示错误。

## 错误

如果流是无缓冲的，或者流的缓冲区需要刷新，则 `fputc()` 函数可能失败：

- **[EAGAIN]**
  为 `stream` 底层的文件描述符设置了 O_NONBLOCK 标志，且线程在写操作中会被延迟。

- **[EBADF]**
  `stream` 底层的文件描述符不是有效的、以写入方式打开的文件描述符。

- **[EFBIG]**
  尝试写入的文件超过了最大文件大小。

- **[EFBIG]**
  尝试写入的文件超过了进程的文件大小限制。同时还应为线程生成 SIGXFSZ 信号。

- **[EFBIG]**
  文件是常规文件，且尝试写入的位置达到或超过了偏移量最大值。

- **[EINTR]**
  写操作因接收到信号而终止，且没有数据被传输。

- **[EIO]**
  发生物理 I/O 错误，或者进程是后台进程组的成员，尝试写入其控制终端，TOSTOP 被设置，调用线程未阻塞 SIGTTOU，进程未忽略 SIGTTOU，且进程的进程组是孤立的。在实现定义的条件下也可能返回此错误。

- **[ENOSPC]**
  包含文件的设备上没有剩余的可用空间。

- **[EPIPE]**
  尝试写入管道或 FIFO，但没有进程为读取而打开。同时还应向线程发送 SIGPIPE 信号。

`fputc()` 函数在以下情况下可能失败：

- **[ENOMEM]**
  可用存储空间不足。

- **[ENXIO]**
  请求了不存在的设备，或者请求超出了设备的能力。

## 示例

无。

## 应用用法

无。

## 基本原理

无。

## 未来方向

无。

## 参见

2.5 标准I/O流，`ferror()`，`fopen()`，`getrlimit()`，`putc()`，`puts()`，`setbuf()`

XBD `<stdio.h>`

## 变更历史

首次发布于 Issue 1。派生自 SVID 的 Issue 1。

### Issue 5

添加了大文件峰会扩展。

### Issue 6

标记了超出 ISO C 标准的扩展。

以下对 POSIX 实现的新要求源于与单一 UNIX 规范的对齐：

- 添加了 [EIO] 和 [EFBIG] 强制错误条件。
- 添加了 [ENOMEM] 和 [ENXIO] 可选错误条件。

应用了 IEEE Std 1003.1-2001/Cor 2-2004，项目 XSH/TC2/D6/37，将 ERRORS 部分中的 [EAGAIN] 错误从"进程会被延迟"更新为"线程会被延迟"。

### Issue 7

进行了与细粒度时间戳支持相关的更改。

应用了 POSIX.1-2008，Technical Corrigendum 1，XSH/TC1-2008/0168 [79] 和 XSH/TC1-2008/0169 [14]。

### Issue 8

应用了 Austin Group Defect 308，阐明了 [EFBIG] 错误的处理。

应用了 Austin Group Defect 1669，移除了与进程文件大小限制相关的 [EFBIG] 错误部分的 XSI 着色。