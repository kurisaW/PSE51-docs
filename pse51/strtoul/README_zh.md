# strtoul

## 概要

```c
#include <stdlib.h>

unsigned long strtoul(const char *restrict str,
                      char **restrict endptr, int base);
unsigned long long strtoull(const char *restrict str,
                            char **restrict endptr, int base);
```

## 描述

[CX] 本参考页描述的功能与 ISO C 标准保持一致。此处描述的要求与 ISO C 标准之间的任何冲突都是无意的。本 POSIX.1-2024 卷遵循 ISO C 标准。

这些函数应将 `str` 指向的字符串的初始部分分别转换为 **unsigned long** 和 **unsigned long long** 类型的表示。首先，它们将输入字符串分解为三个部分：

1.  初始的、可能为空的空白字节序列

2.  解释为整数的主体序列，该整数的基数由 `base` 的值确定

3.  由一个或多个未识别字符组成的最终字符串，包括输入字符串的终止 NUL 字符

然后它们应尝试将主体序列转换为无符号整数，并返回结果。

如果 `base` 的值为 0，主体序列的预期形式为十进制常量、八进制常量或十六进制常量，其中任何一种前面都可以带有 '+' 或 '-' 符号。十进制常量以非零数字开头，由十进制数字序列组成。八进制常量由前缀 '0' 组成，后面可选地跟有仅由数字 '0' 到 '7' 组成的序列。十六进制常量由前缀 0x 或 0X 组成，后面跟有十进制数字和字母 'a'（或 'A'）到 'f'（或 'F'）的序列，这些字母分别表示值 10 到 15。

如果 `base` 的值在 2 到 36 之间，主体序列的预期形式是表示基数为 `base` 的整数的字母和数字序列，前面可选地带有 '+' 或 '-' 符号。从 'a'（或 'A'）到 'z'（或 'Z'）的字母被赋予值 10 到 35；只允许使用其赋值小于 `base` 的字母。如果 `base` 的值为 16，字符 0x 或 0X 可以可选地位于字母和数字序列之前，如果有符号的话，位于符号之后。

主体序列定义为输入字符串的最长初始子序列，从第一个非空白字节开始，具有预期的形式。如果输入字符串为空或完全由空白字节组成，或者如果第一个非空白字节不是符号或允许的字母或数字，则主体序列应不包含任何字符。

如果主体序列具有预期形式且 `base` 的值为 0，从第一个数字开始的字符序列应被解释为整数常量。如果主体序列具有预期形式且 `base` 的值在 2 到 36 之间，它应用作转换的基数，为每个字母赋予如上所述的值。如果主体序列以 <hyphen-minus> 开头，结果值应为转换值的负数；此操作应在返回类型中执行。指向最终字符串的指针应存储在 `endptr` 指向的对象中，前提是 `endptr` 不是空指针。

在 C [CX] 或 POSIX 语言环境之外的其他语言环境中，可以接受其他特定于语言环境的主体序列形式。

如果主体序列为空或不具有预期形式，则不应执行转换；`str` 的值应存储在 `endptr` 指向的对象中，前提是 `endptr` 不是空指针。

如果成功，这些函数不应更改 `errno` 的设置。

由于在错误时返回 0、{ULONG_MAX} 和 {ULLONG_MAX}，这些值在成功时也是有效的返回值，因此希望检查错误情况的应用程序应将 `errno` 设置为 0，然后调用 `strtoul()` 或 `strtoull()`，然后检查 `errno`。

## 返回值

成功完成后，这些函数应返回转换后的值（如果有）。如果无法执行转换，应返回 0 [CX]，并且 `errno` 可能设置为 [EINVAL]。

[CX] 如果 `base` 的值不受支持，应返回 0，`errno` 应设置为 [EINVAL]。

如果正确值超出了可表示值的范围，应返回 {ULONG_MAX} 或 {ULLONG_MAX}，`errno` 设置为 [ERANGE]。

## 错误

这些函数可能在以下情况下失败：

- **[EINVAL]**: [CX] `base` 的值不受支持。
- **[ERANGE]**: 要返回的值不可表示。

这些函数可能在以下情况下失败：

- **[EINVAL]**: [CX] 无法执行转换。

---

*以下部分为补充信息。*

## 示例

无。

## 应用程序用法

由于如果 `base` 的值不受支持，`*endptr` 的值是未指定的，应用程序应在调用前确保 `base` 具有受支持的值（0 或在 2 到 36 之间），或者在检查 `*endptr` 之前检查 [EINVAL] 错误。

## 基本原理

无。

## 未来方向

无。

## 另请参阅

- `fscanf()`
- `isalpha()`
- `strtod()`
- `strtol()`

XBD `<stdlib.h>`

## 变更历史

### 首次发布于第 4 版
源自 ANSI C 标准。

### 第 5 版
更新了描述，指示如果函数成功，`errno` 不会更改。

### 第 6 版
超出了 ISO C 标准的扩展被标记。

以下对 POSIX 实现的新要求源于与单一 UNIX 规范的对齐：

- 为 `base` 的值不受支持的情况添加了 [EINVAL] 错误条件。
- 在返回值和错误部分，如果无法执行转换，添加了 [EINVAL] 可选错误条件。

为与 ISO/IEC 9899:1999 标准对齐进行了以下更改：

- 更新了 `strtoul()` 原型。
- 添加了 `strtoull()` 函数。

### 第 7 版
应用了 POSIX.1-2008、技术勘误 1、XSH/TC1-2008/0621 [105]、XSH/TC1-2008/0622 [453] 和 XSH/TC1-2008/0623 [453]。

应用了 POSIX.1-2008、技术勘误 2、XSH/TC2-2008/0355 [584] 和 XSH/TC2-2008/0356 [796]。

### 第 8 版
应用了 Austin Group 缺陷 700，阐明了如何转换以 <hyphen-minus> 开头的主体序列。

应用了 Austin Group 缺陷 1163，阐明了输入字符串中空白字符的处理。

---

*补充信息结束。*